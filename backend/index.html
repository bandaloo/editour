<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Simple File Upload Example</title>
  </head>
  <body>
    <h1>Simple file upload with asynchronous JavaScript</h1>
    <form id="my-form">
      <input type="text" name="name" placeholder="Name">
      <br>
      <input type="file" name="upload" multiple>
      <br>
      <input type="submit" value="Upload">
    </form>
  </body>
  <script>
    const form = document.getElementById('my-form');

    form.addEventListener('submit', (event) => {
      event.preventDefault();
      sendData(form);
    })

    const sendData = (f) => {
      console.log('here');
      const xhr = new XMLHttpRequest();
      let lastPos = 0;
      const arr = window.location.href.split('/');
      const url = arr[0] + '//' + arr[2];

      // Bind the FormData object and the form element
      const fd = new FormData(f);

      // read partial response
      xhr.onreadystatechange = () => {
        if (xhr.readyState === 3) {
          console.log(xhr.responseText.substring(lastPos));
          lastPos = xhr.responseText.length;
        }
      }

      // successful data submission
      xhr.addEventListener('load', (event) => {
        console.log(event.target.responseText);
      });

      // error
      xhr.addEventListener('error', (event) => {
        console.error('Something went wrong :(');
      });

      // set up request
      xhr.open('POST', url + '/upload');
      xhr.send(fd);
    };
  </script>
</html>